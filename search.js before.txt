/*
function openNewPage() {
  var urlInput = document.getElementById("urlInput").value;
  var selectElement = document.getElementById("options");
  var selectedOption = selectElement.value;
  
  if (urlInput && selectedOption) {
      // Full URL을 조합하여 이동
      var fullUrl = urlInput + '/' + selectedOption;
      location.href = fullUrl;
  } else {
      alert('Please enter a URL and select an option.');
  }
} */

// 새로운 페이지 여는 함수
function openNewPage() {  
    var selectElement = document.getElementById("options");  // 드롭다운 메뉴 요소 가져오기
    var selectedOption = selectElement.value;  // 선택된 옵션의 값 가져오기
    var urlInput = document.getElementById("urlInput").value.trim();  // URL 입력 필드의 값 가져오기 및 공백 제거
    
    if (selectedOption) {  // 옵션이 선택된 경우
        saveRecord(urlInput + "/" + selectedOption);  // 사이드바에 기록 추가 (URL + 선택된 옵션)
        location.href = selectedOption;  // 선택된 옵션 페이지로 이동
    } else {
        alert('Please select a page.');  // 옵션이 선택되지 않은 경우 경고 메시지 표시
    }
}

// 검색 기록을 저장하는 함수
function saveRecord(query) {
    let records = JSON.parse(localStorage.getItem('records')) || [];  // 기존 기록을 가져오거나 빈 배열 생성
    const timestamp = new Date().toISOString();  // 현재 시간을 ISO 형식으로 저장
    records.push({ query, timestamp, name: name || query });  // 새 기록을 배열에 추가 (name이 없으면 query를 name으로 사용)
    localStorage.setItem('records', JSON.stringify(records));  // 로컬 스토리지에 기록을 저장
    const iframeSidebar = document.getElementById('iframesidebar').contentWindow;  // iframe 요소를 가져옴
    iframeSidebar.updateSidebar();  // 사이드바 업데이트 함수 호출
}

// 검색 기록을 열어주는 함수
function openRecord(query) {  // query를 URL로 사용하여 페이지 이동 
    location.href = query;    // (백엔드와 연결 시 여기를 수정)
}

// 로컬 스토리지 변경 시 사이드바 업데이트
window.addEventListener('storage', () => {
    const iframeSidebar = document.getElementById('iframesidebar').contentWindow;  // iframe 요소를 가져옴
    iframeSidebar.updateSidebar();  // 사이드바 업데이트 함수 호출
});

// Enter 키를 눌렀을 때 검색 기록 열기
document.onkeyup = function (e) {
    let keyCode = e.keyCode;  // 눌린 키의 키 코드를 가져옴
    if (keyCode === 13) openRecord();  // Enter 키(키 코드 13)를 누르면 openRecord 함수 호출
}