// 사이드바를 업데이트하는 함수
function updateSidebar() {
    const recordsContainer = document.getElementById('recordsContainer');  // 사이드바 컨테이너 요소를 가져옴
    recordsContainer.innerHTML = '';  // 기존 내용을 지움
    let records = JSON.parse(localStorage.getItem('records')) || [];  // 로컬 스토리지에서 기록을 가져오거나 빈 배열 생성

    // 각 기록을 사이드바 항목으로 추가
    records.forEach((record, index) => {
        let div = document.createElement('div');  // 새로운 div 요소 생성
        div.className = 'sidebar-item';  // 클래스 이름 설정
        div.innerHTML = `<span>${record.name}</span>
                         <button class="edit-button" onclick="editRecord(${index})">✐</button>
                         <button class="delete-button" onclick="deleteRecord(${index})">✖</button>`;  // 기록 이름과 편집/삭제 버튼 추가
        recordsContainer.appendChild(div);  // 사이드바 컨테이너에 추가
    });

    // 각 사이드바 항목에 클릭 이벤트 리스너 추가
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.addEventListener('click', (e) => {
            // 편집 또는 삭제 버튼이 클릭되지 않은 경우에만 기록을 엶
            if (!e.target.classList.contains('edit-button') && !e.target.classList.contains('delete-button')) {
                const recordIndex = Array.from(item.parentNode.children).indexOf(item);  // 클릭된 항목의 인덱스를 가져옴
                const record = records[recordIndex];  // 해당 인덱스의 기록을 가져옴
                if (record) {  // 기록이 있는 경우
                    parent.openRecord(record.query);  // 부모 창에서 openRecord 함수 호출
                } else {
                    alert('Content not found.');  // 기록이 없는 경우 경고 메시지 표시
                }
            }
        });
    });
} 

// 기록을 삭제하는 함수
function deleteRecord(index) {
    if (confirm("삭제하시겠습니까?")) {  // 삭제 확인
        let records = JSON.parse(localStorage.getItem('records')) || [];  // 로컬 스토리지에서 기록을 가져오거나 빈 배열 생성
        records.splice(index, 1);  // 지정한 인덱스의 기록을 삭제
        localStorage.setItem('records', JSON.stringify(records));  // 수정된 기록을 로컬 스토리지에 저장
        updateSidebar();  // 사이드바 업데이트
    }
}

// 기록을 편집하는 함수
function editRecord(index) {
    let records = JSON.parse(localStorage.getItem('records')) || [];  // 로컬 스토리지에서 기록을 가져오거나 빈 배열 생성
    let newName = prompt("제목을 입력하세요:", records[index].name);  // 새 이름을 입력받음
    if (newName) {  // 이름이 입력된 경우
        records[index].name = newName;  // 기록의 이름을 새 이름으로 변경
        localStorage.setItem('records', JSON.stringify(records));  // 수정된 기록을 로컬 스토리지에 저장
        updateSidebar();  // 사이드바 업데이트
    }
}

// 페이지 로드 시 사이드바 업데이트
window.onload = updateSidebar;
// 로컬 스토리지 변경 시 사이드바 업데이트
window.addEventListener('storage', updateSidebar);
